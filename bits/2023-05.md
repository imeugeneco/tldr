# 2023-05

[052723] [API V2 전환과 DB 무중단 마이그레이션 후기](https://medium.com/29cm/api-v2-전환과-db-무중단-마이그레이션-후기-8b39eb0db566) 

- 좋아요 API의 V2 전환 & PostgreSQL 데이터를 MySQL로 무중단 마이그레이션 진행
- 데이터 행이 많아 시간 단위로 마이그레이션을 진행해야 했기에 서비스를 중단, 기존 데이터를 dump, 신규 시스템에 load하는 방법이 아닌 서비스 중단 없이 데이터를 신규 시스템에 스트리밍하여 동기화
- V1 인터페이스를 그대로 마이크로서비스에 포팅하는 대신, V1 API에서 좋아요 설정/해제 시 V2 API에 동기화가 가능하도록 이벤트를 발송하는 구조

나도 곧 100만 행을 훌쩍 넘는 찰리 로그 테이블 마이그레이션을 해야하는데 다른 곳들은 어떻게 했는지 궁금해서 DB 마이그레이션 후기 찾아보면서 본 글. 저번 마이그레이션때 파일이 꼬이면서 개발과 프로덕션 환경이 서로 맞지 않게된 것도 있고, 중단 걸고 할 정도는 아닌 것 같지만 경험도 없는데다가 호출이 가장 자주 일어나는 테이블 중 하나라 좀 막막하다.



[052823] [CORS는 왜 이렇게 우리를 힘들게 하는걸까?](https://evan-moon.github.io/2020/05/21/about-cors/)

* 다른 출처로의 리소스 요청을 제한하는 것과 관련된 두 가지 정책: `CORS (Cross-Origin Resource Sharing)` 와 `SOP(Same-Origin Policy)`
  * `SOP`: 같은 출처에서만 리소스를 공유할 수 있음
  * `CORS`: CORS 정책을 지킨 리소스 요청은 출처가 다르더라도 허용

* `Scheme`, `Host`, `Port`, 이 3가지가 동일하면 같은 출처라고 판단 ([RFC 6454](https://datatracker.ietf.org/doc/html/rfc6454#section-5))
  * 출처를 비교하는 로직은 서버가 아니라 브라우저에 구현된 스펙

* **CORS 동작 플로우**
  * 웹 클라이언트 어플리케이션이 다른 출처의 리소스를 요청할 때는 HTTP 프로토콜을 사용하여 요청을 보내게 되는데, 이때 브라우저는 요청 헤더에 `Origin`이라는 필드에 요청을 보내는 출처를 함께 담아보냄
  * 이후 서버가 이 요청에 대한 응답을 할 때 응답 헤더의 `Access-Control-Allow-Origin`이라는 값에 “이 리소스를 접근하는 것이 허용된 출처”를 내려주고, 이후 응답을 받은 브라우저는 자신이 보냈던 요청의 `Origin`과 서버가 보내준 응답의 `Access-Control-Allow-Origin`을 비교해본 후 이 응답이 유효한 응답인지 아닌지를 결정


개발 편의성을 위해 평소 토이 프로젝트 할 때 `access-control-allow-origin` : `*` 을 넣어줬었는데 김무령한테 혼나고 공부중 ㅜㅜ 

